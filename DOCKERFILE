FROM golang:1.25.6 AS builder

WORKDIR /app

COPY migrations ./migrations

COPY . .

RUN go mod tidy
RUN go mod download

RUN go build -o /app/messanger-service ./cmd/main.go

FROM debian:bookworm-slim

RUN apt-get update && \
    apt-get install -y ca-certificates && \
    rm -rf /var/lib/apt/lists/*

COPY --from=builder /app/messanger-service /bin/messanger-service

# –ö–æ–ø–∏—Ä—É–µ–º –±–∏–Ω–∞—Ä–Ω–∏–∫ –ò–ó builder-–æ–±—Ä–∞–∑–∞
COPY --from=builder /app/messanger-service /bin/messanger-service

# üëá –ö–û–ü–ò–†–£–ï–ú –ú–ò–ì–†–ê–¶–ò–ò –í –§–ò–ù–ê–õ–¨–ù–´–ô –û–ë–†–ê–ó!
COPY --from=builder /app/migrations ./migrations
CMD [ "/bin/messanger-service" ]